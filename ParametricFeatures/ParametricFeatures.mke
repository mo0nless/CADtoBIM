#---------------------------------------------------------------------------------------+
#
#    $Source: ParametricFeatures.mke $
# 
#    $Copyright: (c) 2017 Bentley Systems, Incorporated. All rights reserved. $
#
#---------------------------------------------------------------------------------------+
PolicyFile = MicroStationPolicy.mki
DEFAULT_TARGET_PROCESSOR_ARCHITECTURE=x64

appName     =  ParametricFeatures
sAppName    =  ParametricFeatures

MDLMKI = $(MSMDE)mki/
mdlLibs = $(MSMDE)library/

openCascade = $(IFCO)deps-vs2015-x64-installed/opencascade-7.3.0p3
boost =  $(IFCO)deps/boost_1_67_0
ifcLib =  $(IFCO)installed-vs2015-x64/lib
ifcOpenShell = $(IFCO)src

%include $(MDLMKI)mdl.mki 

#--------------------------------------------------------------------------------------
#    Create needed output directories in case they don't exist
#--------------------------------------------------------------------------------------
always:
    !~@mkdir $(o)
    !~@mkdir $(rscObjects)
    !~@mkdir $(reqdObjs)

#--------------------------------------------------------------------------------------
# http://www.la-solutions.co.uk/content/CONNECT/MicroStationAPI/DevelopmentEnvironment.htm
# If you are building using Bentley Make (bmake.exe), 
# then add the path to the include list using the cincapnd.mki macro. 
# In your make file, add something like this
# dirToSearch = Path to the directory that needs to be included
# %include $(MDLMKI)cincapnd.mki
#--------------------------------------------------------------------------------------

#dirToSearch = $(MDLMKI)
#genSrc = $(o)

dirToSearch = $(openCascade)/inc
%include $(MDLMKI)cincapnd.mki

dirToSearch = $(boost)
%include $(MDLMKI)cincapnd.mki

#dirToSearch = $(ifcOpenShell)/include
dirToSearch = $(ifcOpenShell)
%include $(MDLMKI)cincapnd.mki

#--------------------------------------------------------------------------------------
#    Define macros specific to this example
#--------------------------------------------------------------------------------------
baseDir         = $(_MakeFilePath)
privateInc      = $(baseDir)
langSpec        = $(baseDir)transkit/

libRscs = \
    $(rscObjects)$(sAppName).rsc

#--------------------------------------------------------------------------------------
#    Create object files
#--------------------------------------------------------------------------------------
$(rscObjects)$(sAppName).rsc     : $(baseDir)$(sAppName).r

$(o)$(sAppName).h                : $(baseDir)$(sAppName).r

#--------------------------------------------------------------------------------------
#    Define the object container files
#--------------------------------------------------------------------------------------
appObjects = \
	$(o)$(appName)$(oext) \
	$(o)Initialization$(oext) \
	$(o)GraphicsProcessor$(oext) \
	$(o)GraphicsProcessorEnhancer$(oext) \
	$(o)PropertiesReaderProcessor$(oext) \
	$(o)BooleanFunctionsEnum$(oext) \
	$(o)NumberUtils$(oext) \
	$(o)InitializationEnhancer$(oext) \
	$(o)ResultStatus$(oext) \
	$(o)ResultStatusEnum$(oext) \
	$(o)ReaderPropertiesMapper$(oext) \
	$(o)DictionaryProperties$(oext) \
	$(o)GeneralProperties$(oext) \
	$(o)GraphicProperties$(oext) \
	$(o)ReaderProperties$(oext) \
	$(o)SmartFeatureContainer$(oext) \
	$(o)SmartFeatureTreeNode$(oext) \
	$(o)PrimitiveTypeEnumUtils$(oext) \
	$(o)SlabGraphicProperties$(oext) \
	$(o)ConeGraphicProperties$(oext) \
	$(o)SphereGraphicProperties$(oext) \
	$(o)CylinderGraphicProperties$(oext) \
	$(o)CurveGraphicsProperties$(oext) \
	$(o)TorusGraphicProperties$(oext) \
	$(o)IfcBooleanOperatorHandler$(oext) \
	$(o)IfcPrimitivesBuilder$(oext) \
	$(o)IfcBuilder$(oext) \
	$(o)BooleanOperationProperties$(oext) \
	$(o)CreateSolidsOperationProperties$(oext) \
	$(o)PrimitiveGraphicProperties$(oext) \
	$(o)SmartFeatureGeneralProperties$(oext) \
	$(o)SmartFeatureTypeEnumUtils$(oext) \
	$(o)CurvesTypeEnum$(oext) \
	$(o)ReaderPropertiesEnumUtils$(oext) \
	$(o)BooleanOperationReaderPropertiesMapper$(oext) \


#--------------------------------------------------------------------------------------
#    Set up to use dlmcomp.mki and dlmlink.mki
#--------------------------------------------------------------------------------------

DLM_NAME                = $(appName)
# Specify the output destination folder
DLM_DEST                = $(OPAPPS)
DLM_OBJECT_FILES        = $(appObjects)
DLM_OBJECT_DEST         = $(o)
DLM_LIBDEF_SRC          = $(_MakeFilePath)
DLM_SPECIAL_LINKOPT     = -fixed:no     # Notify linker this library does not require a fixed base address to load
DLM_NO_DLS              = 1             # USE DLLEXPORT IN .CPP
DLM_NO_DEF              = 1
DLM_NOENTRY             = 1
DLM_NO_MANIFEST         = 1             # If not set linker embeds your current (developer) patched MSVCRT version manifest in output dll.  This is not desirable and produces side-by-side CLIENT ERROR: 14001)
DLM_NO_SIGN             = 1             # If not set and no certificate found, ERROR: 'singleton' is not recognized as an internal or external command
DLM_NO_INITIALIZE_FUNCTION  = 1

LINKER_LIBRARIES + $(ifcLib)/IfcParse.lib

LINKER_LIBRARIES + $(ifcLib)/IfcGeom.lib
LINKER_LIBRARIES + $(ifcLib)/IfcGeom_ifc2x3.lib
LINKER_LIBRARIES + $(ifcLib)/IfcGeom_ifc4.lib
LINKER_LIBRARIES + $(ifcLib)/IfcGeom_ifc4x1.lib
LINKER_LIBRARIES + $(ifcLib)/IfcGeom_ifc4x2.lib

LINKER_LIBRARIES + $(ifcLib)/IfcGeom_opencascade.lib
LINKER_LIBRARIES + $(ifcLib)/IfcGeom_opencascade_ifc2x3.lib
LINKER_LIBRARIES + $(ifcLib)/IfcGeom_opencascade_ifc4.lib
LINKER_LIBRARIES + $(ifcLib)/IfcGeom_opencascade_ifc4x1.lib
LINKER_LIBRARIES + $(ifcLib)/IfcGeom_opencascade_ifc4x2.lib

LINKER_LIBRARIES + $(ifcLib)/Serializers.lib
LINKER_LIBRARIES + $(ifcLib)/Serializers_ifc2x3.lib
LINKER_LIBRARIES + $(ifcLib)/Serializers_ifc4.lib
LINKER_LIBRARIES + $(ifcLib)/Serializers_ifc4x1.lib
LINKER_LIBRARIES + $(ifcLib)/Serializers_ifc4x2.lib


LINKER_LIBRARIES + $(mdlLibs)Bentley.lib
LINKER_LIBRARIES + $(mdlLibs)BentleyGeom.lib
LINKER_LIBRARIES + $(mdlLibs)BentleyGeomSerialization.lib
LINKER_LIBRARIES + $(mdlLibs)BentleyAllocator.lib
LINKER_LIBRARIES + $(mdlLibs)DgnPlatform.lib
LINKER_LIBRARIES + $(mdlLibs)DgnView.lib
LINKER_LIBRARIES + $(mdlLibs)mdlbltin.lib
LINKER_LIBRARIES + $(mdlLibs)mspsolid.lib
LINKER_LIBRARIES + $(mdlLibs)PSolidCore.lib 
LINKER_LIBRARIES + $(mdlLibs)RmgrTools.lib
LINKER_LIBRARIES + $(mdlLibs)SmartFeature.lib 
LINKER_LIBRARIES + $(mdlLibs)ECObjects.lib

#--------------------------------------------------------------------------------------
#    Compile the source files for the DLM
#--------------------------------------------------------------------------------------
$(o)$(appName)$(oext) : $(baseDir)sources/$(appName).cpp $(baseDir)headers/$(appName).h 

$(o)Initialization$(oext) : $(baseDir)sources/Initialization.cpp $(baseDir)headers/$(appName).h 

$(o)PropertiesReaderProcessor$(oext) : $(baseDir)sources/PropertiesReaderProcessor.cpp $(baseDir)headers/PropertiesReaderProcessor.h 

$(o)ResultStatus$(oext) : $(baseDir)common/models/result_status/sources/ResultStatus.cpp $(baseDir)common/models/result_status/headers/ResultStatus.h

$(o)ResultStatusEnum$(oext) : $(baseDir)common/enums/sources/ResultStatusEnum.cpp $(baseDir)common/enums/headers/ResultStatusEnum.h

$(o)ReaderPropertiesMapper$(oext) : $(baseDir)mapper/properties/sources/ReaderPropertiesMapper.cpp $(baseDir)mapper/properties/headers/ReaderPropertiesMapper.h

$(o)DictionaryProperties$(oext) : $(baseDir)modeler/properties/sources/DictionaryProperties.cpp $(baseDir)modeler/properties/headers/DictionaryProperties.h

$(o)GeneralProperties$(oext) : $(baseDir)modeler/properties/sources/GeneralProperties.cpp $(baseDir)modeler/properties/headers/GeneralProperties.h

$(o)GraphicProperties$(oext) : $(baseDir)modeler/properties/sources/GraphicProperties.cpp $(baseDir)modeler/properties/headers/GraphicProperties.h

$(o)ReaderProperties$(oext) : $(baseDir)modeler/properties/sources/ReaderProperties.cpp $(baseDir)modeler/properties/headers/ReaderProperties.h

$(o)SmartFeatureContainer$(oext) : $(baseDir)modeler/properties/smart_feature/sources/SmartFeatureContainer.cpp $(baseDir)modeler/properties/smart_feature/headers/SmartFeatureContainer.h

$(o)SmartFeatureTreeNode$(oext) : $(baseDir)modeler/properties/smart_feature/sources/SmartFeatureTreeNode.cpp $(baseDir)modeler/properties/smart_feature/headers/SmartFeatureTreeNode.h

$(o)BooleanFunctionsEnum$(oext) : $(baseDir)common/enums/sources/BooleanFunctionsEnum.cpp $(baseDir)common/enums/headers/BooleanFunctionsEnum.h

$(o)ReaderPropertiesEnumUtils$(oext) : $(baseDir)common/utils/sources/ReaderPropertiesEnumUtils.cpp $(baseDir)common/utils/headers/ReaderPropertiesEnumUtils.h

$(o)PrimitiveTypeEnumUtils$(oext) : $(baseDir)common/utils/sources/PrimitiveTypeEnumUtils.cpp $(baseDir)common/utils/headers/PrimitiveTypeEnumUtils.h

$(o)SlabGraphicProperties$(oext) : $(baseDir)modeler/properties/primitives/graphic/sources/SlabGraphicProperties.cpp $(baseDir)modeler/properties/primitives/graphic/headers/SlabGraphicProperties.h

$(o)ConeGraphicProperties$(oext) : $(baseDir)modeler/properties/primitives/graphic/sources/ConeGraphicProperties.cpp $(baseDir)modeler/properties/primitives/graphic/headers/ConeGraphicProperties.h

$(o)SphereGraphicProperties$(oext) : $(baseDir)modeler/properties/primitives/graphic/sources/SphereGraphicProperties.cpp $(baseDir)modeler/properties/primitives/graphic/headers/SphereGraphicProperties.h

$(o)CylinderGraphicProperties$(oext) : $(baseDir)modeler/properties/primitives/graphic/sources/CylinderGraphicProperties.cpp $(baseDir)modeler/properties/primitives/graphic/headers/CylinderGraphicProperties.h

$(o)TorusGraphicProperties$(oext) : $(baseDir)modeler/properties/primitives/graphic/sources/TorusGraphicProperties.cpp $(baseDir)modeler/properties/primitives/graphic/headers/TorusGraphicProperties.h

$(o)NumberUtils$(oext) : $(baseDir)common/utils/sources/NumberUtils.cpp $(baseDir)common/utils/headers/NumberUtils.h

$(o)GraphicsProcessorEnhancer$(oext) : $(baseDir)utilities/sources/GraphicsProcessorEnhancer.cpp $(baseDir)utilities/headers/GraphicsProcessorEnhancer.h 

$(o)GraphicsProcessor$(oext) : $(baseDir)sources/GraphicsProcessor.cpp $(baseDir)headers/GraphicsProcessor.h 

$(o)InitializationEnhancer$(oext) : $(baseDir)utilities/sources/InitializationEnhancer.cpp $(baseDir)utilities/headers/InitializationEnhancer.h

$(o)IfcBooleanOperatorHandler$(oext) : $(baseDir)ifc/boolean_functions/sources/IfcBooleanOperatorHandler.cpp $(baseDir)ifc/boolean_functions/headers/IfcBooleanOperatorHandler.h

$(o)IfcPrimitivesBuilder$(oext) : $(baseDir)ifc/primitives/sources/IfcPrimitivesBuilder.cpp $(baseDir)ifc/primitives/headers/IfcPrimitivesBuilder.h

$(o)IfcBuilder$(oext) : $(baseDir)ifc/sources/IfcBuilder.cpp $(baseDir)ifc/headers/IfcBuilder.h

$(o)CurveGraphicsProperties$(oext) : $(baseDir)modeler/properties/curves/graphic/sources/CurveGraphicProperties.cpp $(baseDir)modeler/properties/curves/graphic/headers/CurveGraphicProperties.h

$(o)BooleanOperationProperties$(oext) : $(baseDir)modeler/properties/boolean_operations/sources/BooleanOperationProperties.cpp $(baseDir)modeler/properties/boolean_operations/headers/BooleanOperationProperties.h

$(o)CreateSolidsOperationProperties$(oext) : $(baseDir)modeler/properties/create_solids_operations/reader/sources/CreateSolidsOperationProperties.cpp $(baseDir)modeler/properties/create_solids_operations/reader/headers/CreateSolidsOperationProperties.h

$(o)PrimitiveGraphicProperties$(oext) : $(baseDir)modeler/properties/primitives/graphic/sources/PrimitiveGraphicProperties.cpp $(baseDir)modeler/properties/primitives/graphic/headers/PrimitiveGraphicProperties.h

$(o)SmartFeatureGeneralProperties$(oext) : $(baseDir)modeler/properties/smart_feature/sources/SmartFeatureGeneralProperties.cpp $(baseDir)modeler/properties/smart_feature/headers/SmartFeatureGeneralProperties.h

$(o)BooleanOperationReaderPropertiesMapper$(oext) : $(baseDir)mapper/properties/sources/BooleanOperationReaderPropertiesMapper.cpp $(baseDir)mapper/properties/headers/BooleanOperationReaderPropertiesMapper.h

$(o)SmartFeatureTypeEnumUtils$(oext) : $(baseDir)common/utils/sources/SmartFeatureTypeEnumUtils.cpp $(baseDir)common/utils/headers/SmartFeatureTypeEnumUtils.h

$(o)CurvesTypeEnum$(oext) : $(baseDir)common/enums/sources/CurvesTypeEnum.cpp $(baseDir)common/enums/headers/CurvesTypeEnum.h

%include $(MDLMKI)dlmlink.mki

#CLinkOpts + /NODEFAULTLIB:libcmt.lib
#CLinkOpts + /NODEFAULTLIB:libcmtd.lib
#CLinkOpts + /NODEFAULTLIB:msvcrtd.lib

#--------------------------------------------------------------------------------------
#    Merge the dialog resources & MDL program file using rlib
#--------------------------------------------------------------------------------------
$(reqdObjs)$(appName).mi        : $(libRscs)
    $(msg)
    > $(o)make.opt
    -o$@
    $(libRscs)
    <
    $(RLibCmd) @$(o)make.opt
    ~time

#--------------------------------------------------------------------------------------
#    complete construction of the .ma
#--------------------------------------------------------------------------------------
libRscs = \
    $(reqdObjs)$(appName).mi

#$(mdlapps)$(appName).ma : $(libRscs)
$(OPAPPS)$(appName).ma : $(libRscs)
        $(msg)
        > $(rscObjects)make.opt
        -o$@
        $(libRscs)
        <
        $(RLibCmd) @$(rscObjects)make.opt
        ~time